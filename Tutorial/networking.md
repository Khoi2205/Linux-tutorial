## Internet interface

Giao diện mạng là kênh kết nối giữa thiết bị và mạng. về mặt vật lý, giao diện mạng có thể tiến hành thông qua card mạng (NIC- Network Interface Card) hoặc có thể được triển khai lý thuyết bởi các phần mềm. Bạn có thể có nhiều Network Interfaces được hoạt động trong cùng một lúc. Interface cụ thể có thể được đưa lên(activated) hoặc đưa xuống (de-actieved-Loại bỏ) vào bất cứ lúc nào. Một danh sách các Network Interface hiện đang hoạt động được hiển thị bởi tiện ích  `Ifconfig`. Các tập cấu hình mạng là rất cần thiết để đảm bảo các hoạt động chính xác.

Fill cấu hình network ở những nơi khác nhau tùy vào mỗi nền tảng:
* Debian: `/etc/network/interfaces`
* CentOS: `/etc/sysconfig/network-script`
## Các file cấu hình Network
### 1. /etc/hosts
* Dùng để phân giải những hostname không thể phân giải được
* có thể dùng DNS trong hệ thống mạng LAN
    * `127.0.0.1` <=> `localhoat.localdomain`
    * `::1` <=> `localhost.localdomain`
```
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```
### 2. /etc/resolv.conf
* Dùng để cấu hình DNS
```
[root@huydv ~]# cat /etc/resolv.conf
# Generated by NetworkManager
search localdomain
nameserver 192.168.141.2
```
### 3. /etc/sysconfig/network-scripts-[tên-card-mạng]
* Chứa thông tin cấu hình của từng card mạng
* Đối với cấu hình hệ thống **RedHat**, thông tin định tuyến(route) và máy chủ(host) được chứa trong `/etc/sysconfig/network`. Thông tin cấu hình mạng cho cổng card mạng(`ens33`,`eth1`) được đặt trong `/etc/sysconfig/network-scripts/ifcfg-ens33`. 
```
[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=7b3f832a-f4a4-47c3-b1de-2088c7c2eafb
DEVICE=ens33
ONBOOT=yes
```
## Các lệnh Network cơ bản 
1. Xem địa chỉ IP
```
# ifconfig         (Ethernet + Loopback)
# iwconfig         (Wifi)
# ifconfig -a      (Đầy đủ thông tin)
# ip a s
```
2. Bật / tắt card mạng
```
# ifup [tên card mạng]
# ifdown [tên card mạng]
```
3. Khởi động lại `network.service`

`# service network restart`  

or 

`# systemctl restart network.service` 

or

`# /etc/init.d/network restart   `
4. Xem thông tin gateway
* Có 2 cách để xem thông tin là : `route -n` và `ip route`
```
[root@huydv ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         gateway         0.0.0.0         UG    100    0        0 ens33
192.168.141.0   0.0.0.0         255.255.255.0   U     100    0        0 ens33
[root@huydv ~]# ip route
default via 192.168.141.2 dev ens33 proto dhcp metric 100
192.168.141.0/24 dev ens33 proto kernel scope link src 192.168.141.133 metric 100
```
## Cấu hình IP
1. Cấu hình bằng lệnh (tạm thời)

## Routing table
Câu lệnh `route` sử dụng để xem và thay đổi địa chỉ IP  của bảng định tuyến. Bạn muốn thay đổi bảng định tuyến IP để thêm, xóa hoặc sửa đổi các định tuyến tĩnh thành các máy chủ hoặc mạng cụ thể.

`# ifconfig [tên_card_mạng] [IP] netmask [subnet_mask] up`
> **Chú ý**:IP sẽ mất mỗi khi tắt mở card mạng hay restart `network.service `. Đây còn là cách đặt IP tạm thời, thường dùng để test.

2. Cấu hình bằng file 
* Thay đổi nội dung trong file cấu hình của mạng :

`# vi /etc/systconfig/network-scripts/ifcfg-[tên_card_mạng]`

* Ý nghĩa thông số trong file:
    * `DEVICE`:
    * `BOOTPROTO` :
        * `static`: dùng IP tĩnh
        * `dhcp` : nhận IP từ DHCP Server 
    * `IPADDR` : địa chỉ IP của card mạng ( khi cấu hình IP tĩnh)
    * `NETMASK` : Địa chỉ subnetmask ( Khi cấu hình IP tĩnh )
    * `GATEWAY` : địa chỉ `GATEWAY` ( khi cấu hình IP tĩnh)
    * `USERCTL` :
        * `yes` : cho phép user thường cấu hình sửa đổi
        * `no` : không cho phép user thường cấu hình sửa đổi.
    * `ONBOOT`:
        * `yes`: Khởi động khi restart `network.sevice`
        * `no` : Không khởi động khi restart `network.service `

**Ví dụ**: Thiết lập IP tĩnh và IP động với server 
* IP tĩnh có IP:`10.10.1.12/24`, gateway `10.10.10.254`, DNS là `8.8.8.8`
```
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
IPADDR=10.10.1.12
NETMASK=255.255.255.0
GATEWAY=10.10.1.254
DNS=8.8.8.8
USERCTL=no
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=7b3f832a-f4a4-47c3-b1de-2088c7c2eafb
DEVICE=ens33
ONBOOT=yes
```
* Thiết lập IP DHCP :
```
DEVICE=ens33
ONBOOT=yes
BOOTPROTO=dhcp
USERCTL=no
```

Sau đó restart lại network: `service restart network`
3. Cấu hình bằng giao diện GUI
* Trong Terminal gõ lệnh `#nmtui`
* trong cửa sổ **NetworkManager TUI** hiện ra, chọn **Edit a connect** => **OK**
<img src=https://i.imgur.com/y4eMSIq.png>

* Chọn Card mạng cần chỉnh sửa:
<img src=https://imgur.com/uOVjyeJ.png>

* Chọn IPV4 CONFIGURATION => Manual => <show>

<img src=https://imgur.com/cw4pwsj.png>

* Đặt các thông số rồi **OK** :

4. Cấu hình bằng `nmcli`
* Đây là công cụ giúp điều khiển trình quản lý mạng trong Linux bằng dòng lệnh.
* Xem các trạng thái kết nối cơ bản:<br>`# nmcli [option] [command] [argument]`

    * `option`:
        * `-a`: Hiển thị thông tin về phần cứn card mạng gốm MAC, MTU, IP, ...
        * `-v`: hiển thị version của `nmcli`
    * `Command` + `Arguments`:
        * `general`: Sử dụng lệnh để hiển thị trạng thái và quyền của trình quản lý mạng
            * `status`: Hiển thị trạng thái chung của networkmanager. 
            * `hostname` :Dùng để thay đổi và nhận tên máy chủ hệ thống. Không có đối số sẽ hiện thị tên máy chủ
            * `permissions`: Hiển thị các quyền mà người gọi có đối với các hoạt động
        * `networking`:
            * `on`: enable card mạng
            * `off`: disable card mạng
            * `connectivity`: xem trạng thái kết nối:
                * `full`: đã kết nối mạng và được truy cập internet
                * `limited`: đã kết nối mạng nhưng không được phép truy cập internet
                * `none`: chưa được kết nối mạng
        * `radio`:
            * `all`: hiển thị trạng thái tất cả các kết nối không dây
            * `wifi`: hiển thị trạng thái tất cả các kết nối không dây
                * `off`: disable card wifi
                * `on`: enable card wifi
        * `monitor`: quản lý status mạng theo runtime
        * `connection`:NetworkManager lưu trữ tất cả cấu hình mạng dưới dạng `connection`, là tập hợp dữ liệu mô tả cách tạo ra hoặc kết nối mạng.Thay vì cấu hình thủ công card mạng mỗi lần thay đổimạng
            * `show --active`: Hiển thị các kết nối đang active
            * `up`-`down`: Kích hoạt kết nối. Kết nối được xác định theo tên, đường dẫn UUID hoặc D-Bus.
            * `modify`: Thêm sửa đổi hoặc loại bỏ các thuộc tính trong hồ sơ connection. Để đặt thuộc tính, chỉ cần chỉ đinh tên thuộc tính theo sau là giá trij`ip4`,`ipv4.addresses`,`ipv4.dns`,`ipv4.gateway`,...
        * `device` :
            * `status` : hiện thị trạng thái các interface
            * `wifi list`: liệt kê các sóng wifi bắt được
                * `--auto`
                * `--rescan `:
            * `Wifi connect`:kết nối tới mạng wifi đã biết

## Thay đổi về dạng `eth*`
### Chỉnh sửa tham số kernel boot
* **B1** : Kiểm tra thông tin interface hiện tại:<br>`#ifconfig `
* **B2**: Chỉnh sửa file `/etc/default/grub` <br>`#vi /etc/default/grub` <br>Thêm câu lệnh `net.ifnames=0 biosdevname=0` vào dòng `GRUB_CMDLINE_LINUX`

```
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0"
GRUB_DISABLE_RECOVERY="true"
```
* **B3** Biên dịch lại file `grub` để ghi lại cấu hình mới: <br> `[root@huydv ~]# grub2-mkconfig -o /boot/grub2/grub.cfg`
## Chỉnh sửa file cấu hình mạng
Chỉnh sửa file cấu hình mạng ban đầu là `ens33` thành `eth0`
* **B1**: đổi tên file cấu hình card mạng:
```
[root@huydv ~]# cd /etc/sysconfig/network-scripts/
[root@huydv network-scripts]# mv ifcfg-ens33 ifcfg-eth0
[root@huydv network-scripts]# vi ifcfg-eth0

DEVICE=eth0
NAME=eth0
```
* **B2** : Disable NetworkManager <br> Đảm bảo rằng NetworkManager không hoàn nguyên ác thay đổi khi khởi động lại máy hay khởi động lại mạng
    * `systemctl disable NetworkManager`
* **B3** `reboot` máy và kiểm tra lại